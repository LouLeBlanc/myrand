# RPM build instructions for myrand

---

## Preparing the RPM build
Building an RPM from this git repo can be performed with the `rpmbuild` target.
Before building an RPM, be sure the RPM version information is updated on the following lines of the `myrand.spec` file:

```
Version:	0.1
Release:	1%{?dist}
```

Next, add a changelog to the top of the `%changelog` section:
```
%changelog
* Sat Sep 1 2018 Louis LeBlanc <lleblanc@brandeis.edu> - 0.1.1
- First myrand package
```

### Formatting the changelog
The following formatting rules must be followed:  
*Always add new entries just below the `%changelog` line with a blank line between entries.  
*The changelog should be in chronological order from newest to older entries.  
*The date should aways be in the format as displayed by the `date +"%a %b %e %Y"` command.  

Once this is correct, commit the changes and build the RPM with the following command:

```
make rpmbuild
```
This target will perform the following steps:
1. Create the source archive
2. Set up the RPM build tree in ~/rpmbuild
3. Copy the archive and RPM spec to the RPM build tree
4. Perform the RPM build
5. Copy the RPMS directory from ~/rpmbuild back to the project directory

When complete, there will be an RPMS directory tree with the RPM present as indicated by the output of the `tree` command:

<pre>
$ make rpmbuild
RPM build complete
<font color="#0087FF">RPMS</font>
└── <font color="#0087FF">x86_64</font>
    └── <font color="#FF0000">myrand-0.1-1.fc28.x86_64.rpm</font>

1 directory, 1 file
</pre>

When the build is complete, verify the RPM:
```
$ rpm -qpl RPMS/x86_64/myrand-0.1-1.fc28.x86_64.rpm
/usr/bin/myrand
/usr/lib/.build-id
/usr/lib/.build-id/03
/usr/lib/.build-id/03/8f8b39df3afb22129be159f48ad3473a5b7ed7
/usr/share/doc/myrand
/usr/share/doc/myrand/README.md
```

Next, use the rpm basename to create a git tag to mark the point at which this build was made:
```
$ git tag myrand-0.1-1.fc28.x86_64
```
Verify the latest git log:
<pre>$ git log -n 1
<font color="#FFFF00"><b>commit d44e351cc41f04203053291e273983bc711f2359 (</b></font><font color="#00FFFF"><b>HEAD -&gt; </b></font><font color="#00FF00"><b>master</b></font><font color="#FFFF00"><b>, tag: myrand-0.1-1.fc28.x86_64)</b></font>
Author: Louis LeBlanc &lt;lleblanc@brandeis.edu&gt;
Date:   Sat Sep 1 09:37:44 2018 -0400

    Clean up build. Add RPMBuild document.
</pre>

### Note:
Before calling `make clean` in the build directory, be sure to copy the RPM to another location.  Cleaning the build directory will remove all artifacts generated by make.

